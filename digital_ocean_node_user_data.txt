#!/bin/bash

apt-get -y update

export HOSTNAME=$(curl -s http://169.254.169.254/metadata/v1/hostname)
export PUBLIC_IPV4=$(curl -s http://169.254.169.254/metadata/v1/interfaces/public/0/ipv4/address)

cd /tmp
wget https://bitcoincore.org/bin/bitcoin-core-0.18.0/bitcoin-0.18.0-x86_64-linux-gnu.tar.gz
tar -zxvf bitcoin-0.18.0-x86_64-linux-gnu.tar.gz
cd bitcoin-0.18.0/bin

mv bitcoin-cli /usr/bin/bitcoin-cli
mv bitcoind /usr/bin/bitcoind
mv bitcoin-tx /usr/bin/bitcoin-tx
mv bitcoin-wallet /usr/bin/bitcoin-wallet

cd

mkdir .bitcoin
touch .bitcoin/bitcoin.conf

echo -e "daemon=1" >> .bitcoin/bitcoin.conf
echo -e "server=1" >> .bitcoin/bitcoin.conf
echo -e "rpcallowip=0.0.0.0/0" >> .bitcoin/bitcoin.conf
echo -e "rpcauth=bitstoptestnet:60455988fbf512f4ed6df6f8defbc17$4dd9b880a684e958cdfaaf99feb68b9ff03a8212d4a726bc5852ae1d18aae252" >> .bitcoin/bitcoin.conf
echo -e "addresstype=bech32" >> .bitcoin/bitcoin.conf
echo -e "prune=5000" >> .bitcoin/bitcoin.conf

(crontab -l 2>/dev/null; echo "@reboot bitcoind") | crontab -

reboot